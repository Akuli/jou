from "./ast.jou" import AstFile
from "./tokenizer.jou" import tokenize, print_tokens
from "./parser.jou" import parse
from "./find_jou_installation.jou" import find_stdlib
from "stdlib/mem.jou" import free
from "stdlib/str.jou" import strcmp
from "stdlib/io.jou" import fprintf, stderr

def main(argc: int, argv: byte**) -> int:
    if argc == 3 and strcmp(argv[1], "--tokenize-only") == 0:
        tokens = tokenize(argv[2])
        print_tokens(tokens)
        free(tokens)
    elif argc == 3 and strcmp(argv[1], "--parse-only") == 0:
        tokens = tokenize(argv[2])
        stdlib_path = find_stdlib()
        ast = parse(tokens, stdlib_path)
        ast.print()
        ast.free()
        free(tokens)
        free(stdlib_path)
    else:
        fprintf(stderr, "Usage:\n")
        fprintf(stderr, "  %s --tokenize-only FILENAME\n", argv[0])
        fprintf(stderr, "  %s --parse-only FILENAME\n", argv[0])
        return 2

    return 0

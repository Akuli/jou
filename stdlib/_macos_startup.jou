# A call to the _jou_macos_startup() function is inserted to the
# start of every Jou program when compiling for MacOS.

# On macos, the C "global variables" stdin, stdout and stderr have
# different names. For simplicity, Jou redefines them as variables
# with the same names and assigns the correct values to them.
#
# We can't import FILE from io.jou here, because then we would be
# trying to define a variable that already exists.
global stdin: void*
global stdout: void*
global stderr: void*
declare global __stdinp: void*
declare global __stdoutp: void*
declare global __stderrp: void*

def _jou_macos_startup() -> void:
    stdin = __stdinp
    stdout = __stdoutp
    stderr = __stderrp

# On linux, C's errno is a macro that expands to (*__errno_location()).
# On macos it expands to (*__error()) instead. Let's make it consistent.
declare __error() -> int*
def __errno_location() -> int*:
    return __error()

# Without a suppression file, most leaks have call_init() in them.
# Many of these leaks seem to be present even if my main() does nothing.
# Presumably these happen whenever libLLVM loads.
# There's also one of these from a different library, so catch that too.
{
   <initialization of dynamically linked libraries>
   Memcheck:Leak
   match-leak-kinds: reachable
   ...
   fun:call_init
   ...
}

# Many leaks seem to come from LLVM IR building code, even though I'm pretty
# sure I clean up everything I'm supposed to clean up.
# For now, suppress all errors coming from LLVM functions.
#
# Ideally we could say fun:LLVM* (function name starts with LLVM), but that
# doesn't work with C++ function name mangling.
{
   <llvm functions>
   Memcheck:Leak
   match-leak-kinds: reachable,possible
   ...
   obj:*/libLLVM*.so.*
   ...
}

# Not a leak. Apparently LLVM versions 16, 17 and 18 read uninitialized memory
# but behavior doesn't depend on the data they read.
{
   <compute known bits bug LLVM 16 version>
   Memcheck:Cond
   obj:*/libLLVM-16.so.1
   obj:*/libLLVM-16.so.1
   fun:_ZN4llvm16computeKnownBits*
   fun:_ZNK4llvm12SelectionDAG13InferPtrAlignENS_7SDValueE
   obj:*/libLLVM-16.so.1
   obj:*/libLLVM-16.so.1
   fun:_ZN4llvm12SelectionDAG7CombineENS_12CombineLevel*
   fun:_ZN4llvm16SelectionDAGISel17CodeGenAndEmitDAGEv
   fun:_ZN4llvm16SelectionDAGISel20SelectAllBasicBlocksERKNS_8FunctionE
   fun:_ZN4llvm16SelectionDAGISel20runOnMachineFunctionERNS_15MachineFunctionE
   obj:*/libLLVM-16.so.1
   fun:_ZN4llvm19MachineFunctionPass13runOnFunctionERNS_8FunctionE
   fun:_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE
   fun:_ZN4llvm13FPPassManager11runOnModuleERNS_6ModuleE
   fun:_ZN4llvm6legacy15PassManagerImpl3runERNS_6ModuleE
   ...
}
{
   <compute known bits bug LLVM 17 version>
   Memcheck:Cond
   obj:*/libLLVM-17.so.1
   obj:*/libLLVM-17.so.1
   fun:_ZN4llvm16computeKnownBits*
   fun:_ZNK4llvm12SelectionDAG13InferPtrAlignENS_7SDValueE
   obj:*/libLLVM-17.so.1
   obj:*/libLLVM-17.so.1
   fun:_ZN4llvm12SelectionDAG7CombineENS_12CombineLevel*
   fun:_ZN4llvm16SelectionDAGISel17CodeGenAndEmitDAGEv
   fun:_ZN4llvm16SelectionDAGISel20SelectAllBasicBlocksERKNS_8FunctionE
   fun:_ZN4llvm16SelectionDAGISel20runOnMachineFunctionERNS_15MachineFunctionE
   obj:*/libLLVM-17.so.1
   fun:_ZN4llvm19MachineFunctionPass13runOnFunctionERNS_8FunctionE
   fun:_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE
   fun:_ZN4llvm13FPPassManager11runOnModuleERNS_6ModuleE
   fun:_ZN4llvm6legacy15PassManagerImpl3runERNS_6ModuleE
   ...
}
{
   <compute known bits bug LLVM 18 version>
   Memcheck:Cond
   obj:*/llvm-18/lib/libLLVM.so.1
   obj:*/llvm-18/lib/libLLVM.so.1
   fun:_ZN4llvm16computeKnownBits*
   fun:_ZNK4llvm12SelectionDAG13InferPtrAlignENS_7SDValueE
   obj:*/llvm-18/lib/libLLVM.so.1
   obj:*/llvm-18/lib/libLLVM.so.1
   fun:_ZN4llvm12SelectionDAG7CombineENS_12CombineLevel*
   fun:_ZN4llvm16SelectionDAGISel17CodeGenAndEmitDAGEv
   fun:_ZN4llvm16SelectionDAGISel20SelectAllBasicBlocksERKNS_8FunctionE
   fun:_ZN4llvm16SelectionDAGISel20runOnMachineFunctionERNS_15MachineFunctionE
   obj:*/llvm-18/lib/libLLVM.so.1
   fun:_ZN4llvm19MachineFunctionPass13runOnFunctionERNS_8FunctionE
   fun:_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE
   fun:_ZN4llvm13FPPassManager11runOnModuleERNS_6ModuleE
   fun:_ZN4llvm6legacy15PassManagerImpl3runERNS_6ModuleE
   ...
}

import "stdlib/mem.jou"
import "stdlib/list.jou"

import "./hash.jou"
import "./target.jou"
import "./ast.jou"
import "./llvm.jou"
import "./command_line_args.jou"


@public
class FileState:
    path: byte*  # owned, unique, always set
    ast: AstFile
    module: LLVMModule*

    def free(self) -> None:
        self.ast.free()
        free(self.path)


@public
class CompilerState:
    stdlib_path: byte*  # owned
    args: CommandLineArgs
    files: List[FileState]
    warnings_shown: bool  # for the --fail-on-warnings compiler flag
    cached_compiler_hash: Hash
    target: Target

    def free(self) -> None:
        free(self.stdlib_path)
        for p = self.files.ptr; p < self.files.end(); p++:
            p.free()
        free(self.files.ptr)


# Yes, I know, everyone hates global variables, especially public global variables...
#
# For now, there wouldn't be much advantage in passing this around.
# Can be cleaned up later if needed.
@public
global global_compiler_state: CompilerState

# Boring boilerplate code to free up data structures used in compilation.

import "stdlib/mem.jou"

import "./structs.jou"
import "./types.jou"
import "./token.jou"
import "./typecheck/common.jou"

def free_tokens(tokenlist: Token*) -> None:
    for t = tokenlist; t->kind != TokenKind::EndOfFile; t++:
        if t->kind == TokenKind::String:
            free(t->long_string)
    free(tokenlist)

def free_constant(c: Constant*) -> None:
    if c->kind == ConstantKind::String:
        free(c->str)

def free_signature(sig: Signature*) -> None:
    free(sig->argnames)
    free(sig->argtypes)

def free_export_symbol(es: ExportSymbol*) -> None:
    if es->kind == ExportSymbolKind::Function:
        free_signature(&es->funcsignature)

def free_file_types(ft: FileTypes*) -> None:
    for t = ft->owned_types; t < &ft->owned_types[ft->n_owned_types]; t++:
        free_type(*t)
    for func = ft->functions; func < &ft->functions[ft->nfunctions]; func++:
        free_signature(&func->signature)
    for fom = ft->fomtypes; fom < &ft->fomtypes[ft->nfomtypes]; fom++:
        for et = fom->expr_types; et < &fom->expr_types[fom->n_expr_types]; et++:
            free(*et)
        free(fom->expr_types)
        free(fom->locals)  # Don't free individual locals because they're owned by CFG now
        free_signature(&fom->signature)
    free(ft->globals)
    free(ft->types)
    free(ft->owned_types)
    free(ft->functions)
    free(ft->fomtypes)

import "stdlib/io.jou"
import "stdlib/time.jou"

if not NETBSD:
    import "stdlib/intnative.jou"

def main() -> int:
    # Check that `time()` function returns seconds since 1970 by calculating
    # the current year. This test will break after a few years, but I want to
    # set a maximum in tests so I know I'm not e.g. getting milliseconds.
    seconds_in_year = 31557600
    year = 1970 + time(NULL) / seconds_in_year

    # Output: year ok
    if year < 2025:
        printf("year too small\n")
    elif year > 2030:
        printf("year too big\n")
    else:
        printf("year ok\n")

    # Ensure that `time()` return value matches what it places in the pointer
    if NETBSD:
        t1: int64 = 0x1234_5678_abcd_cafe
    else:
        t1: intnative = 0xffff
    t2 = time(&t1)
    if t1 != t2:
        printf("wat %lld %lld\n", t1 as int64, t2 as int64)

    return 0
